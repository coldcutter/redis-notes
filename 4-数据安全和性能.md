# 4 数据安全和性能

## 4.1 持久化选项

Redis提供两种方式持久化数据到磁盘，一种是 _snapshotting_ ，保存某一时刻的数据到磁盘，另一种是 _append-only file_ \(AOF\)，把对Redis的写操作记录到磁盘。

![](/assets/QQ20160823-1.png)

5种方法创建snapshot：

* BGSAVE命令，在支持BGSAVE的平台上（除了Windows），Redis会fork一个子进程来把快照写到磁盘，父进程继续响应命令。
* SAVE命令，使得Redis停止响应任何命令直到快照创建完毕，这个命令不常用，除非等待快照创建完成是ok的，或者没有足够的内存使用BGSAVE。
* save配置项，比如save 60 10000，表示如果从上次成功的save以来，60秒内出现了10000次写，Redis自动触发一个BGSAVE操作，如果有多条save选项，任意一条满足就会触发BGSAVE。
* 当Redis被请求关闭（SHUTDOWN命令）或接收一个标准的TERM信号，Redis执行一个SAVE，组织客户端执行任意命令，然后关闭。
* 如果一个Redis server连到另一个Redis server且发出一个SYNC命令开始执行 replication ，master Redis server会开始一个BGSAVE操作（如果没有正在执行BGSAVE操作或最近完成过）。

快照常用场景：开发，聚合日志，大数据

例子：在一个68G内存的云Xen虚拟机上，Redis使用了50G内存，

